<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Notas</title>
</head>

<body>

    <div class="container">
        <div class="text-center">
            <h1>Mural de Notas</h1>
            <input id="title" type="text" placeholder="Insira uma nota" />
            <input id="description" type="text" placeholder="Insira uma nota" />
            <button id="submit" class="btn btn-primary">Enviar</button>
        </div>


        <%for(let teste of notes) {%>

            <div class="card my-3">
                <div class="card-header">
                    <h5 class="card-title">
                        Título: <%=teste.title%>
                    </h5>
                </div>
                <div class="card-body">
                    <h6 class="card-subtitle mb-3 text-muted">
                        Descrição: <%=teste.description%>
                    </h6>
                    <button id="<%=teste.id%>" class="btn btn-danger delete">Apagar Nota</button>
                </div>
            </div>

            <%}%>
    </div>

    <script>

        const submit = document.querySelector('#submit')
        submit.addEventListener('click', createNote)

        function createNote() {
            const title = document.querySelector('#title').value
            const description = document.querySelector('#description').value

            const options = {
                method: 'POST',
                headers: { 'Content-type': 'application/json' },
                body: JSON.stringify({ title, description })
            }

            fetch(`http://localhost:3000/api/newNote`, options).then((res) => {
                if (res.status === 200) {
                    location.reload()
                }

            })

        }

        const remove = document.querySelectorAll('.delete')
        remove.forEach((item) => {
            item.addEventListener('click', deleteNote)
        })

        function deleteNote(e) {

            const options = {
                method: 'delete'
            }

            fetch(`http://localhost:3000/api/deleteNote/${e.target.id}`, options)

            location.reload()
        }


    </script>

</body>

</html>